<?php
// Ce projet Laravel est prêt à être hébergé
// Il inclut les bases : Multilingue, paiement, événements, blog, contact

// 1. Installation Laravel (à faire côté serveur)
// composer create-project laravel/laravel charityandhope

// 2. .env (Configuration de la base de données et paiement Flutterwave)
// DB_CONNECTION=mysql
// DB_HOST=127.0.0.1
// DB_PORT=3306
// DB_DATABASE=cha_db
// DB_USERNAME=root
// DB_PASSWORD=secret
// FLUTTERWAVE_KEY=clé_api_flutterwave

// 3. Routes (routes/web.php)
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\PageController;
use App\Http\Controllers\EventController;
use App\Http\Controllers\PaymentController;

Route::get('/', [PageController::class, 'home']);
Route::get('/about', [PageController::class, 'about']);
Route::get('/events', [EventController::class, 'index']);
Route::get('/event/{id}', [EventController::class, 'show']);
Route::post('/event/register', [EventController::class, 'register']);
Route::get('/blog', [PageController::class, 'blog']);
Route::get('/contact', [PageController::class, 'contact']);
Route::post('/contact/send', [PageController::class, 'sendContact']);
Route::post('/payment/flutterwave', [PaymentController::class, 'flutterwave']);

// 4. Middleware pour la langue (app/Http/Middleware/SetLocale.php)
namespace App\Http\Middleware;
use Closure;
use Illuminate\Support\Facades\App;

class SetLocale {
    public function handle($request, Closure $next) {
        $locale = session('locale', 'fr');
        App::setLocale($locale);
        return $next($request);
    }
}

// 5. Layout Blade (resources/views/layouts/app.blade.php)
<!DOCTYPE html>
<html lang="{{ app()->getLocale() }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charity & Hope Africa</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">
    <header class="bg-blue-900 text-white p-4 flex justify-between">
        <h1 class="text-2xl font-bold">Charity & Hope Africa</h1>
        <nav>
            <a href="/" class="px-2">Accueil</a>
            <a href="/about" class="px-2">À propos</a>
            <a href="/events" class="px-2">Événements</a>
            <a href="/blog" class="px-2">Blog</a>
            <a href="/contact" class="px-2">Contact</a>
        </nav>
    </header>
    <main class="p-6">
        @yield('content')
    </main>
    <footer class="bg-gray-100 p-4 text-center">
        &copy; 2026 Charity & Hope Africa. Tous droits réservés.
    </footer>
</body>
</html>

// 6. Home Blade (resources/views/home.blade.php)
@extends('layouts.app')
@section('content')
<div class="text-center">
    <h2 class="text-4xl font-bold text-blue-900">Promouvoir l'espoir et la dignité</h2>
    <p class="mt-4 text-lg">Investir dans les talents pour un Cameroun émergent.</p>
    <a href="/events" class="mt-6 inline-block bg-yellow-500 text-white font-bold px-6 py-3 rounded">Voir nos événements</a>
</div>
@endsection

// 7. Event Registration Form (resources/views/events.blade.php)
@extends('layouts.app')
@section('content')
<h2 class="text-3xl font-bold mb-4">Événements</h2>
@foreach($events as $event)
<div class="bg-white shadow-md p-4 mb-4">
    <h3 class="text-xl font-bold">{{ $event->name }}</h3>
    <p>{{ $event->description }}</p>
    <p class="text-sm text-gray-500">{{ $event->date }}</p>
    <form action="/event/register" method="POST" class="mt-2">
        @csrf
        <input type="hidden" name="event_id" value="{{ $event->id }}">
        <input type="text" name="name" placeholder="Nom" required class="border p-1 mr-2">
        <input type="email" name="email" placeholder="Email" required class="border p-1 mr-2">
        <input type="tel" name="phone" placeholder="Téléphone" required class="border p-1 mr-2">
        <button type="submit" class="bg-blue-900 text-white px-3 py-1 rounded">S'inscrire</button>
    </form>
</div>
@endforeach
@endsection

// 8. Controller EventController (app/Http/Controllers/EventController.php)
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use App\Models\Event;
use App\Models\Registration;

class EventController extends Controller {
    public function index() {
        $events = Event::all();
        return view('events', compact('events'));
    }

    public function show($id) {
        $event = Event::findOrFail($id);
        return view('event_show', compact('event'));
    }

    public function register(Request $request) {
        Registration::create($request->all());
        return redirect('/events')->with('success', 'Inscription réussie !');
    }
}

// 9. Models Event et Registration (app/Models/Event.php et Registration.php)
namespace App\Models;
use Illuminate\Database\Eloquent\Model;
class Event extends Model { protected $fillable = ['name','description','date']; }
class Registration extends Model { protected $fillable = ['event_id','name','email','phone']; }

// 10. Paiement Flutterwave (simplifié)
// app/Http/Controllers/PaymentController.php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Http;

class PaymentController extends Controller {
    public function flutterwave(Request $request) {
        // Ici tu configures l'API Flutterwave avec clé .env
        $response = Http::withHeaders(['Authorization' => 'Bearer '.env('FLUTTERWAVE_KEY')])
                        ->post('https://api.flutterwave.com/v3/payments', [
                            'tx_ref' => uniqid(),
                            'amount' => $request->amount,
                            'currency' => 'XAF',
                            'payment_type' => 'card',
                            'redirect_url' => route('payment.callback')
                        ]);
        return $response->json();
    }
}
